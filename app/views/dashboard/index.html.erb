<h1>Notification Hub</h1>

<% if notice.present? %>
  <p style="color: green;"><%= notice %></p>
<% end %>

<% if alert.present? %>
  <p style="color: red;"><%= alert %></p>
<% end %>

<hr>

<h2>Send a message</h2>

<%= form_with model: Message.new, url: messages_path, method: :post do |f| %>
  <div style="margin-bottom: 12px;">
    <%= f.label :category %><br>
    <%= f.select :category, options_for_select(@categories.map { |c| [c.titleize, c] }) %>
  </div>

  <div style="margin-bottom: 12px;">
    <%= f.label :body, "Message" %><br>
    <%= f.text_area :body, rows: 4, cols: 60, placeholder: "Type your message..." %>
  </div>

  <%= f.submit "Send" %>
<% end %>

<hr>

<h2>Log history</h2>

<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>Created At</th>
      <th>User</th>
      <th>Category</th>
      <th>Channel</th>
      <th>Status</th>
      <th>Delivered At</th>
      <th>Error</th>
    </tr>
  </thead>
  <tbody>
    <% @notification_logs.each do |log| %>
      <tr>
        <td><%= log.created_at %></td>
        <td><%= log.user&.name %> (ID: <%= log.user_id %>)</td>
        <td><%= log.message&.category %></td>
        <td><%= log.channel %></td>
        <td><%= log.status %></td>
        <td><%= log.delivered_at %></td>
        <td><%= log.error_message %></td>
      </tr>
    <% end %>
  </tbody>
</table>
